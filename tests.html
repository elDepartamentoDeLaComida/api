<!doctype html>
<html>
  <head>
    <title>Coverage</title>
    <script>
      headings = [];

      onload = function(){
          headings = document.querySelectorAll('h2');
      };

      onscroll = function(e){
          var heading = find(window.scrollY);
          if (!heading) return;
          var links = document.querySelectorAll('#menu a')
                  , link;

          for (var i = 0, len = links.length; i < len; ++i) {
              link = links[i];
              link.className = link.getAttribute('href') == '#' + heading.id ? 'active' : '';
          }
      };

      function find(y) {
          var i = headings.length
                  , heading;

          while (i--) {
              heading = headings[i];
              if (y >= heading.offsetTop) {
                  return heading;
              }
          }
      }
    </script>
    <style>
    body {
        font: 14px/1.6 Helvetica, Arial, sans-serif;
        margin: 0;
        color: #2c2c2c;
    }

    #coverage {
        padding: 60px;
    }

    h1 a:hover {
        text-decoration: none;
    }

    h2 {
        width: 80%;
        margin-top: 80px;
        margin-bottom: 0;
        font-weight: 100;
        letter-spacing: 1px;
    }

    ul {
        margin-top: 20px;
        padding: 0 15px;
        width: 100%;
    }

    ul li {
        float: left;
        width: 40%;
        margin-top: 5px;
        margin-right: 60px;
        list-style: none;
        padding: 5px 0;
        font-size: 12px;
    }

    #menu {
        position: fixed;
        font-size: 12px;
        overflow-y: auto;
        top: 0;
        right: 0;
        margin: 0;
        height: 100%;
        padding: 15px 15px;
        border-left: 1px solid #eee;
        background-color: #666;
    }

    #menu::after {
        display: block;
        content: '';
        padding-top: 80px;
    }

    #menu li a {
        display: block;
        color: white;
        padding: 0 5px 0 35px;
        transition: background 300ms;
        text-decoration: none;
    }

    #menu li {
        position: relative;
        list-style: none;
    }

    #menu a:hover,
    #menu a.active {
        text-decoration: none;
        background: rgba(255,255,255,.4);
    }

    #menu li:hover .cov {
        opacity: 1;
    }

    #menu li .dirname {
        opacity: .60;
        padding-right: 2px;
    }

    #menu li .basename {
        opacity: 1;
    }

    #menu .cov {
        background: rgba(0,0,0,.3);
        position: absolute;
        top: 0;
        font-size: 9px;
        text-align: center;
        opacity: .8;
        width: 22px;
        border-radius: 10px;
        padding: 2px 3px;
    }

    .stats:nth-child(2n) {
        display: inline-block;
        margin-top: 15px;
        border: 1px solid #eee;
        padding: 10px;
        border-radius: 5px;
    }

    .stats div {
        float: left;
        padding: 0 5px;
    }

    .stats::after {
        display: block;
        content: '';
        clear: both;
    }

    .stats .sloc::after {
        content: ' SLOC';
        color: #b6b6b6;
    }

    .stats .percentage::after {
        content: ' coverage';
        color: #b6b6b6;
    }

    .stats .hits,
    .stats .misses {
        display: none;
    }

    .high {
        color: #00d4b4;
    }
    .medium {
        color: #e87d0d;
    }
    .low {
        color: #d4081a;
    }
    .terrible {
        color: #d4081a;
        font-weight: bold;
    }

    table {
        width: 80%;
        margin-top: 10px;
        border-collapse: collapse;
        border: 1px solid #cbcbcb;
        color: #363636;
        border-radius: 3px;
    }

    table thead {
        display: none;
    }

    table td.line,
    table td.hits {
        width: 20px;
        background: #eaeaea;
        text-align: center;
        font-size: 11px;
        padding: 0 10px;
        color: #949494;
    }

    table td.hits {
        width: 10px;
        padding: 2px 5px;
        color: rgba(0,0,0,.2);
        background: #f0f0f0;
    }

    tr.miss td.line,
    tr.miss td.hits {
        background: #e6c3c7;
    }

    tr.miss td {
        background: #f8d5d8;
    }

    td.source {
        padding-left: 15px;
        line-height: 15px;
        white-space: pre;
        font: 12px monaco, monospace;
    }

    td.source div {
        display: inline-block;
    }

    td.source div.true {
        background: #bae8bf;
    }

    td.source div.false {
        background: #e8e5ba;
    }

    td.source div.never {
        background: #f8d5d8;
    }
    </style>
  </head>
  <body>
    <div id="coverage">
        <h1 id="overview">Code Coverage Report</h1>
        <div id="menu">
            <li><a href="#overview">overview</a></li>
            
            <li>
                <span class="cov high">100</span>
                <a href="#database.js"><span class="basename">database.js</span></a>
            </li>
            
            <li>
                <span class="cov high">87.18</span>
                <a href="#index.js"><span class="basename">index.js</span></a>
            </li>
            
            <li>
                <span class="cov high">100</span>
                <a href="#routes.js"><span class="basename">routes.js</span></a>
            </li>
            
            <li>
                <span class="cov high">100</span>
                <a href="#server.config.js"><span class="basename">server.config.js</span></a>
            </li>
            
            <li>
                <span class="cov medium">68.06</span>
                <a href="#controllers/authRoutes.js"><span class="dirname">controllers/</span><span class="basename">authRoutes.js</span></a>
            </li>
            
            <li>
                <span class="cov high">90.43</span>
                <a href="#controllers/orderRoutes.js"><span class="dirname">controllers/</span><span class="basename">orderRoutes.js</span></a>
            </li>
            
            <li>
                <span class="cov high">87.36</span>
                <a href="#controllers/saleRoutes.js"><span class="dirname">controllers/</span><span class="basename">saleRoutes.js</span></a>
            </li>
            
            <li>
                <span class="cov high">89.25</span>
                <a href="#controllers/userRoutes.js"><span class="dirname">controllers/</span><span class="basename">userRoutes.js</span></a>
            </li>
            
            <li>
                <span class="cov medium">64.46</span>
                <a href="#logic/user-logic.js"><span class="dirname">logic/</span><span class="basename">user-logic.js</span></a>
            </li>
            
            <li>
                <span class="cov high">100</span>
                <a href="#models/schema.js"><span class="dirname">models/</span><span class="basename">schema.js</span></a>
            </li>
            
            <li>
                <span class="cov high">94.29</span>
                <a href="#utils/myUtils.js"><span class="dirname">utils/</span><span class="basename">myUtils.js</span></a>
            </li>
            
        </div>
        <div class="stats high">
            <div class="percentage">84.92%</div>
            <div class="sloc">769</div>
            <div class="hits">653</div>
            <div class="misses">116</div>
        </div>
        <div id="files">
            
            <div class="file">
                <h2 id="database.js">database.js</h2>
                <div class="stats high">
                    <div class="percentage">100%</div>
                    <div class="sloc">11</div>
                    <div class="hits">11</div>
                    <div class="misses">0</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Line</th>
                            <th>Hits</th>
                            <th>Source</th>
                        </tr>
                    </thead>
                    <tbody>
                
                    
                        <tr class="hit">
                            <td class="line">1</td>
                            <td class="hits">1</td>
                            <td class="source">var mongoose = require(&quot;mongoose&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">2</td>
                            <td class="hits"></td>
                            <td class="source">  ConfigDB = require(&quot;./server.config&quot;).mongoLocal;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">3</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">4</td>
                            <td class="hits"></td>
                            <td class="source">//SETUP</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">5</td>
                            <td class="hits">1</td>
                            <td class="source">mongoose.connect(&quot;mongodb://&quot; + ConfigDB.url + &quot;/&quot; + ConfigDB.database);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">6</td>
                            <td class="hits">1</td>
                            <td class="source">var db = mongoose.connection;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">7</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">8</td>
                            <td class="hits">1</td>
                            <td class="source">db.on(&quot;error&quot;, console.error.bind(console, &quot;connection error:&quot;));</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">9</td>
                            <td class="hits">1</td>
                            <td class="source">db.once(&quot;open&quot;, function () {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">10</td>
                            <td class="hits">1</td>
                            <td class="source">  console.log(&quot;Connected to DB:&quot;, ConfigDB);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">11</td>
                            <td class="hits"></td>
                            <td class="source">});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">12</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">13</td>
                            <td class="hits">1</td>
                            <td class="source">exports.mongoose = mongoose;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">14</td>
                            <td class="hits">1</td>
                            <td class="source">exports.db = db;</td>
                        </tr>
                    
                
                    </tbody>
                </table>
            </div>
            
            <div class="file">
                <h2 id="index.js">index.js</h2>
                <div class="stats high">
                    <div class="percentage">87.18%</div>
                    <div class="sloc">39</div>
                    <div class="hits">34</div>
                    <div class="misses">5</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Line</th>
                            <th>Hits</th>
                            <th>Source</th>
                        </tr>
                    </thead>
                    <tbody>
                
                    
                        <tr class="hit">
                            <td class="line">1</td>
                            <td class="hits">1</td>
                            <td class="source">&quot;use strict&quot;;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">2</td>
                            <td class="hits">1</td>
                            <td class="source">var bunyan = require(&quot;bunyan&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">3</td>
                            <td class="hits"></td>
                            <td class="source">  Config = require(&quot;./server.config&quot;);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">4</td>
                            <td class="hits">1</td>
                            <td class="source">var log = bunyan.createLogger({</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">5</td>
                            <td class="hits"></td>
                            <td class="source">    name: Config.logger.name,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">6</td>
                            <td class="hits"></td>
                            <td class="source">    serializers: bunyan.stdSerializers,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">7</td>
                            <td class="hits"></td>
                            <td class="source">    streams: Config.logger.streams</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">8</td>
                            <td class="hits"></td>
                            <td class="source">  });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">9</td>
                            <td class="hits">1</td>
                            <td class="source">var Hapi = require(&quot;hapi&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">10</td>
                            <td class="hits"></td>
                            <td class="source">  Routes = require(&quot;./routes&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">11</td>
                            <td class="hits"></td>
                            <td class="source">  db = require(&quot;./database&quot;).db;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">12</td>
                            <td class="hits"></td>
                            <td class="source">//require(&quot;stackup&quot;);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">13</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">14</td>
                            <td class="hits"></td>
                            <td class="source">//LEAVE CORS TRUE TO ALLOW LOCALHOST TESTING</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">15</td>
                            <td class="hits"></td>
                            <td class="source">//LEAVE ABORT EARLY TRUE FOR DEBUG</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">16</td>
                            <td class="hits">1</td>
                            <td class="source">var server = new Hapi.Server(Config.server.port, Config.server.hostname, Config.options);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">17</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">18</td>
                            <td class="hits"></td>
                            <td class="source">//START</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">19</td>
                            <td class="hits">1</td>
                            <td class="source">server.pack.register([require(&#x27;lout&#x27;), require(&quot;hapi-auth-cookie&quot;)], function (err) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">20</td>
                                <td class="hits"></td>
                                <td class="source"><div>  if (</div><div class="miss false">err</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">21</td>
                                <td class="hits"></td>
                                <td class="source">    throw err;</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">22</td>
                            <td class="hits"></td>
                            <td class="source">  }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">23</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">24</td>
                            <td class="hits">1</td>
                            <td class="source">  server.auth.strategy(&#x27;session&#x27;, &#x27;cookie&#x27;, {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">25</td>
                            <td class="hits"></td>
                            <td class="source">    password: &quot;localOrDie&quot;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">26</td>
                            <td class="hits"></td>
                            <td class="source">    cookie: &quot;elDept&quot;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">27</td>
                            <td class="hits"></td>
                            <td class="source">    redirectTo: false,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">28</td>
                            <td class="hits"></td>
                            <td class="source">    isSecure: false,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">29</td>
                            <td class="hits"></td>
                            <td class="source">    ttl: 24 * 60 * 60 * 1000 //1 day session</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">30</td>
                            <td class="hits"></td>
                            <td class="source">  });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">31</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">32</td>
                            <td class="hits">1</td>
                            <td class="source">  server.ext(&quot;onRequest&quot;, function (request, next) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">33</td>
                            <td class="hits">9</td>
                            <td class="source">    console.log(request.path, request.query);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">34</td>
                            <td class="hits">9</td>
                            <td class="source">    next();</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">35</td>
                            <td class="hits"></td>
                            <td class="source">  });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">36</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">37</td>
                            <td class="hits">1</td>
                            <td class="source">  server.route(Routes.endpoints);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">38</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">39</td>
                                <td class="hits"></td>
                                <td class="source"><div>  if (</div><div class="miss false">!module.parent</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">40</td>
                                <td class="hits"></td>
                                <td class="source">    server.start(function () {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">41</td>
                                <td class="hits"></td>
                                <td class="source">      console.log(&#x27;Server started at: &#x27; + server.info.uri);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">42</td>
                            <td class="hits"></td>
                            <td class="source">    });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">43</td>
                            <td class="hits"></td>
                            <td class="source">  }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">44</td>
                            <td class="hits">1</td>
                            <td class="source">  exports.server = server;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">45</td>
                            <td class="hits"></td>
                            <td class="source">});</td>
                        </tr>
                    
                
                    </tbody>
                </table>
            </div>
            
            <div class="file">
                <h2 id="routes.js">routes.js</h2>
                <div class="stats high">
                    <div class="percentage">100%</div>
                    <div class="sloc">16</div>
                    <div class="hits">16</div>
                    <div class="misses">0</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Line</th>
                            <th>Hits</th>
                            <th>Source</th>
                        </tr>
                    </thead>
                    <tbody>
                
                    
                        <tr class="hit">
                            <td class="line">1</td>
                            <td class="hits">1</td>
                            <td class="source">var orderRoutes = require(&quot;./controllers/orderRoutes&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">2</td>
                            <td class="hits"></td>
                            <td class="source">  saleRoutes = require(&quot;./controllers/saleRoutes&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">3</td>
                            <td class="hits"></td>
                            <td class="source">  authRoutes = require(&quot;./controllers/authRoutes&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">4</td>
                            <td class="hits"></td>
                            <td class="source">  userRoutes = require(&quot;./controllers/userRoutes&quot;);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">5</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">6</td>
                            <td class="hits">1</td>
                            <td class="source">exports.endpoints = [</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">7</td>
                            <td class="hits"></td>
                            <td class="source">  {method: &quot;GET&quot;, path: &quot;/api/orders&quot;, config: orderRoutes.getOrders},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">8</td>
                            <td class="hits"></td>
                            <td class="source">  {method: &quot;POST&quot;, path: &quot;/api/orders&quot;, config: orderRoutes.postOrders},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">9</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">10</td>
                            <td class="hits"></td>
                            <td class="source">  {method: &quot;GET&quot;, path: &quot;/api/sales&quot;, config: saleRoutes.getTotal},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">11</td>
                            <td class="hits"></td>
                            <td class="source">  {method: &quot;POST&quot;, path: &quot;/api/sales&quot;, config: saleRoutes.postSale},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">12</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">13</td>
                            <td class="hits"></td>
                            <td class="source">  {method: &quot;POST&quot;, path: &quot;/auth/login&quot;, config: authRoutes.authenticate},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">14</td>
                            <td class="hits"></td>
                            <td class="source">  {method: &quot;GET&quot;, path: &quot;/auth/logout&quot;, config: authRoutes.logout},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">15</td>
                            <td class="hits"></td>
                            <td class="source">  {method: &quot;GET&quot;, path: &quot;/&quot;, config: authRoutes.login},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">16</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">17</td>
                            <td class="hits"></td>
                            <td class="source">  {method: &quot;POST&quot;, path: &quot;/users&quot;, config: userRoutes.register},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">18</td>
                            <td class="hits"></td>
                            <td class="source">  {method: &quot;DELETE&quot;, path: &quot;/users/{username}&quot;, config: userRoutes.delete},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">19</td>
                            <td class="hits"></td>
                            <td class="source">  {method: &quot;GET&quot;, path: &quot;/users/{username?}&quot;, config: userRoutes.get}</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">20</td>
                            <td class="hits"></td>
                            <td class="source">];</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">21</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    </tbody>
                </table>
            </div>
            
            <div class="file">
                <h2 id="server.config.js">server.config.js</h2>
                <div class="stats high">
                    <div class="percentage">100%</div>
                    <div class="sloc">56</div>
                    <div class="hits">56</div>
                    <div class="misses">0</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Line</th>
                            <th>Hits</th>
                            <th>Source</th>
                        </tr>
                    </thead>
                    <tbody>
                
                    
                        <tr class="hit">
                            <td class="line">1</td>
                            <td class="hits">1</td>
                            <td class="source">module.exports = {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">2</td>
                            <td class="hits"></td>
                            <td class="source">  mongoLocal: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">3</td>
                            <td class="hits"></td>
                            <td class="source">    url: &quot;localhost&quot;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">4</td>
                            <td class="hits"></td>
                            <td class="source">    database: &quot;test&quot;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">5</td>
                            <td class="hits"></td>
                            <td class="source">  },</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">6</td>
                            <td class="hits"></td>
                            <td class="source">  mongo: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">7</td>
                            <td class="hits"></td>
                            <td class="source">    dbuser: &#x27;michael&#x27;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">8</td>
                            <td class="hits"></td>
                            <td class="source">    password: &#x27;MAP13xbox&#x27;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">9</td>
                            <td class="hits"></td>
                            <td class="source">    url: &#x27;ds051459.mongolab.com:51459&#x27;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">10</td>
                            <td class="hits"></td>
                            <td class="source">    database: &#x27;eldeptdev&#x27;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">11</td>
                            <td class="hits"></td>
                            <td class="source">  },</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">12</td>
                            <td class="hits"></td>
                            <td class="source">  server: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">13</td>
                            <td class="hits"></td>
                            <td class="source">    hostname: &quot;localhost&quot;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">14</td>
                            <td class="hits"></td>
                            <td class="source">    port: 8080</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">15</td>
                            <td class="hits"></td>
                            <td class="source">  },</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">16</td>
                            <td class="hits"></td>
                            <td class="source">  app: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">17</td>
                            <td class="hits"></td>
                            <td class="source">    pages: &quot;http://localhost:8000&quot;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">18</td>
                            <td class="hits"></td>
                            <td class="source">  },</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">19</td>
                            <td class="hits"></td>
                            <td class="source">  logger: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">20</td>
                            <td class="hits"></td>
                            <td class="source">    name: &quot;Interal Dept Systems&quot;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">21</td>
                            <td class="hits"></td>
                            <td class="source">    streams: [</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">22</td>
                            <td class="hits"></td>
                            <td class="source">      {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">23</td>
                            <td class="hits"></td>
                            <td class="source">        type: &quot;rotating-file&quot;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">24</td>
                            <td class="hits"></td>
                            <td class="source">        level: &quot;info&quot;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">25</td>
                            <td class="hits"></td>
                            <td class="source">        path: &quot;./log/info/info.log&quot;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">26</td>
                            <td class="hits"></td>
                            <td class="source">        //stream: process.stdout</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">27</td>
                            <td class="hits"></td>
                            <td class="source">        period: &#x27;1d&#x27;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">28</td>
                            <td class="hits"></td>
                            <td class="source">        count: 10</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">29</td>
                            <td class="hits"></td>
                            <td class="source">      },</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">30</td>
                            <td class="hits"></td>
                            <td class="source">      {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">31</td>
                            <td class="hits"></td>
                            <td class="source">        type: &quot;rotating-file&quot;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">32</td>
                            <td class="hits"></td>
                            <td class="source">        level: &quot;error&quot;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">33</td>
                            <td class="hits"></td>
                            <td class="source">        path: &quot;./log/error/error.log&quot;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">34</td>
                            <td class="hits"></td>
                            <td class="source">        //stream: process.stdout</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">35</td>
                            <td class="hits"></td>
                            <td class="source">        period: &#x27;1d&#x27;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">36</td>
                            <td class="hits"></td>
                            <td class="source">        count: 10</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">37</td>
                            <td class="hits"></td>
                            <td class="source">      }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">38</td>
                            <td class="hits"></td>
                            <td class="source">    ]</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">39</td>
                            <td class="hits"></td>
                            <td class="source">  },</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">40</td>
                            <td class="hits"></td>
                            <td class="source">  options: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">41</td>
                            <td class="hits"></td>
                            <td class="source">    cors: true,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">42</td>
                            <td class="hits"></td>
                            <td class="source">    validation: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">43</td>
                            <td class="hits"></td>
                            <td class="source">      abortEarly: false</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">44</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">45</td>
                            <td class="hits"></td>
                            <td class="source">},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">46</td>
                            <td class="hits"></td>
                            <td class="source">    test: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">47</td>
                            <td class="hits"></td>
                            <td class="source">        credentials: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">48</td>
                            <td class="hits"></td>
                            <td class="source">            _id: &quot;test&quot;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">49</td>
                            <td class="hits"></td>
                            <td class="source">            scope: 0,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">50</td>
                            <td class="hits"></td>
                            <td class="source">            password: &#x27;$2a$10$BuQzLFsX7W/MHOSI4q3x8uIbuWnp0NTlZUfrYTTk6IIoBToCbA04C&#x27;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">51</td>
                            <td class="hits"></td>
                            <td class="source">            name: &quot;Test User&quot;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">52</td>
                            <td class="hits"></td>
                            <td class="source">            __v: 0,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">53</td>
                            <td class="hits"></td>
                            <td class="source">            loginAttempts: 0</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">54</td>
                            <td class="hits"></td>
                            <td class="source">        }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">55</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">56</td>
                            <td class="hits"></td>
                            <td class="source">};</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">57</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    </tbody>
                </table>
            </div>
            
            <div class="file">
                <h2 id="controllers/authRoutes.js">controllers/authRoutes.js</h2>
                <div class="stats medium">
                    <div class="percentage">68.06%</div>
                    <div class="sloc">72</div>
                    <div class="hits">49</div>
                    <div class="misses">23</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Line</th>
                            <th>Hits</th>
                            <th>Source</th>
                        </tr>
                    </thead>
                    <tbody>
                
                    
                        <tr class="hit">
                            <td class="line">1</td>
                            <td class="hits"></td>
                            <td class="source">//ROUTES</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">2</td>
                            <td class="hits"></td>
                            <td class="source">//AUTHENTICATION</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">3</td>
                            <td class="hits">1</td>
                            <td class="source">var bunyan = require(&quot;bunyan&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">4</td>
                            <td class="hits"></td>
                            <td class="source">  Config = require(&quot;../server.config&quot;);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">5</td>
                            <td class="hits">1</td>
                            <td class="source">var log = bunyan.createLogger({</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">6</td>
                            <td class="hits"></td>
                            <td class="source">    name: Config.logger.name,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">7</td>
                            <td class="hits"></td>
                            <td class="source">    serializers: bunyan.stdSerializers,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">8</td>
                            <td class="hits"></td>
                            <td class="source">    streams: Config.logger.streams</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">9</td>
                            <td class="hits"></td>
                            <td class="source">  });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">10</td>
                            <td class="hits">1</td>
                            <td class="source">var Joi = require(&quot;joi&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">11</td>
                            <td class="hits"></td>
                            <td class="source">  Hapi = require(&quot;hapi&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">12</td>
                            <td class="hits"></td>
                            <td class="source">  User = require(&quot;../logic/user-logic&quot;).User,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">13</td>
                            <td class="hits"></td>
                            <td class="source">  path = require(&quot;path&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">14</td>
                            <td class="hits"></td>
                            <td class="source">  myutils = require(&quot;../utils/myUtils&quot;);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">15</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">16</td>
                            <td class="hits">1</td>
                            <td class="source">exports.authenticate = {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">17</td>
                            <td class="hits"></td>
                            <td class="source">  validate: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">18</td>
                            <td class="hits"></td>
                            <td class="source">    payload: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">19</td>
                            <td class="hits"></td>
                            <td class="source">      username: Joi.string().required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">20</td>
                            <td class="hits"></td>
                            <td class="source">      password: Joi.string().required()</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">21</td>
                            <td class="hits"></td>
                            <td class="source">    },</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">22</td>
                            <td class="hits"></td>
                            <td class="source">  },</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">23</td>
                            <td class="hits"></td>
                            <td class="source">  auth: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">24</td>
                            <td class="hits"></td>
                            <td class="source">    mode: &quot;try&quot;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">25</td>
                            <td class="hits"></td>
                            <td class="source">    strategy: &quot;session&quot;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">26</td>
                            <td class="hits"></td>
                            <td class="source">  },</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">27</td>
                            <td class="hits"></td>
                            <td class="source">  plugins: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">28</td>
                            <td class="hits"></td>
                            <td class="source">    &quot;hapi-auth-cookie&quot;: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">29</td>
                            <td class="hits"></td>
                            <td class="source">      redirectTo: false</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">30</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">31</td>
                            <td class="hits"></td>
                            <td class="source">  },</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">32</td>
                            <td class="hits"></td>
                            <td class="source">  handler: function (req, reply) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">33</td>
                                <td class="hits"></td>
                                <td class="source">    log.info({METHOD: &quot;POST AUTHENTICATION&quot;});</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">34</td>
                                <td class="hits"></td>
                                <td class="source">    User.getAuthenticated(req.payload.username, req.payload.password, function (err, user, reason) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">35</td>
                                <td class="hits"></td>
                                <td class="source">      console.error(err);</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">36</td>
                                <td class="hits"></td>
                                <td class="source">      console.error(user);</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">37</td>
                                <td class="hits"></td>
                                <td class="source">      console.error(reason);</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">38</td>
                                <td class="hits"></td>
                                <td class="source">      if (err) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">39</td>
                                <td class="hits"></td>
                                <td class="source">        console.error({err: err});</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">40</td>
                            <td class="hits"></td>
                            <td class="source">      }</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">41</td>
                                <td class="hits"></td>
                                <td class="source">      if (user) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">42</td>
                                <td class="hits"></td>
                                <td class="source">        log.info({&quot;User logged in&quot;: user});</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">43</td>
                                <td class="hits"></td>
                                <td class="source">        req.auth.session.set(user);</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">44</td>
                                <td class="hits"></td>
                                <td class="source">        console.log(req.auth);</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">45</td>
                                <td class="hits"></td>
                                <td class="source">        return reply({redirect: Config.app.pages + &quot;/adminMenu.html&quot;, user: user});</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">46</td>
                            <td class="hits"></td>
                            <td class="source">      }</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">47</td>
                                <td class="hits"></td>
                                <td class="source">      var reasons = User.failedLogin;</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">48</td>
                                <td class="hits"></td>
                                <td class="source">      switch (reason) {</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">49</td>
                            <td class="hits"></td>
                            <td class="source">      case reasons.NOT_FOUND:</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">50</td>
                            <td class="hits"></td>
                            <td class="source">      case reasons.PASSWORD_INCORRECT:</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">51</td>
                                <td class="hits"></td>
                                <td class="source">        reply(Hapi.error.badRequest(&quot;User/password pair incorrect&quot;));</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">52</td>
                                <td class="hits"></td>
                                <td class="source">        break;</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">53</td>
                            <td class="hits"></td>
                            <td class="source">      case reasons.MAX_ATTEMPTS:</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">54</td>
                                <td class="hits"></td>
                                <td class="source">        reply(Hapi.error.unauthorized(&quot;Too many attempts, try later&quot;));</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">55</td>
                                <td class="hits"></td>
                                <td class="source">        break;</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">56</td>
                            <td class="hits"></td>
                            <td class="source">      }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">57</td>
                            <td class="hits"></td>
                            <td class="source">    });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">58</td>
                            <td class="hits"></td>
                            <td class="source">  }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">59</td>
                            <td class="hits"></td>
                            <td class="source">};</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">60</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">61</td>
                            <td class="hits">1</td>
                            <td class="source">exports.login = {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">62</td>
                            <td class="hits"></td>
                            <td class="source">  handler: function (req, reply) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">63</td>
                                <td class="hits"></td>
                                <td class="source">    if (req.auth.isAuthenticated) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">64</td>
                                <td class="hits"></td>
                                <td class="source">      return reply({redirect: Config.app.pages + &quot;/adminMenu.html&quot;});</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">65</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">66</td>
                                <td class="hits"></td>
                                <td class="source">    return reply({redirect: Config.app.pages + &quot;/index.html&quot;});</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">67</td>
                            <td class="hits"></td>
                            <td class="source">  }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">68</td>
                            <td class="hits"></td>
                            <td class="source">};</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">69</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">70</td>
                            <td class="hits">1</td>
                            <td class="source">exports.logout = {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">71</td>
                            <td class="hits"></td>
                            <td class="source">    handler: function (req, reply) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">72</td>
                                <td class="hits"></td>
                                <td class="source">        req.auth.session.clear();</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">73</td>
                                <td class="hits"></td>
                                <td class="source">        return reply.redirect(&#x27;/&#x27;);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">74</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">75</td>
                            <td class="hits"></td>
                            <td class="source">}</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">76</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    </tbody>
                </table>
            </div>
            
            <div class="file">
                <h2 id="controllers/orderRoutes.js">controllers/orderRoutes.js</h2>
                <div class="stats high">
                    <div class="percentage">90.43%</div>
                    <div class="sloc">115</div>
                    <div class="hits">104</div>
                    <div class="misses">11</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Line</th>
                            <th>Hits</th>
                            <th>Source</th>
                        </tr>
                    </thead>
                    <tbody>
                
                    
                        <tr class="hit">
                            <td class="line">1</td>
                            <td class="hits"></td>
                            <td class="source">//ROUTES</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">2</td>
                            <td class="hits"></td>
                            <td class="source">//ORDERS</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">3</td>
                            <td class="hits">1</td>
                            <td class="source">var bunyan = require(&quot;bunyan&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">4</td>
                            <td class="hits"></td>
                            <td class="source">  Config = require(&quot;../server.config&quot;);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">5</td>
                            <td class="hits">1</td>
                            <td class="source">var log = bunyan.createLogger({</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">6</td>
                            <td class="hits"></td>
                            <td class="source">    name: Config.logger.name,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">7</td>
                            <td class="hits"></td>
                            <td class="source">    serializers: bunyan.stdSerializers,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">8</td>
                            <td class="hits"></td>
                            <td class="source">    streams: Config.logger.streams</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">9</td>
                            <td class="hits"></td>
                            <td class="source">  });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">10</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">11</td>
                            <td class="hits">1</td>
                            <td class="source">var myUtils = require(&quot;../utils/myUtils&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">12</td>
                            <td class="hits"></td>
                            <td class="source">  Joi = require(&quot;joi&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">13</td>
                            <td class="hits"></td>
                            <td class="source">  Order = require(&quot;../models/schema&quot;).Order,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">14</td>
                            <td class="hits"></td>
                            <td class="source">  Item = require(&quot;../models/schema&quot;).Item;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">15</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">16</td>
                            <td class="hits"></td>
                            <td class="source">//var Hapi = plugin.hapi;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">17</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">18</td>
                            <td class="hits"></td>
                            <td class="source">//ROUTE FOR POSTING ORDERS TO THE DB</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">19</td>
                            <td class="hits">1</td>
                            <td class="source">exports.postOrders = {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">20</td>
                            <td class="hits"></td>
                            <td class="source">  auth: &quot;session&quot;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">21</td>
                            <td class="hits"></td>
                            <td class="source">  validate: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">22</td>
                            <td class="hits"></td>
                            <td class="source">    payload: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">23</td>
                            <td class="hits"></td>
                            <td class="source">      farmer: Joi.string().required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">24</td>
                            <td class="hits"></td>
                            <td class="source">      farmerInitials: Joi.string().required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">25</td>
                            <td class="hits"></td>
                            <td class="source">      productName: Joi.alternatives().try(Joi.string(), Joi.array().includes(Joi.string())).required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">26</td>
                            <td class="hits"></td>
                            <td class="source">      quantity: Joi.alternatives().try(Joi.number().min(1), Joi.array().includes(Joi.number().min(1))).required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">27</td>
                            <td class="hits"></td>
                            <td class="source">      price: Joi.alternatives().try(Joi.number().min(0), Joi.array().includes(Joi.number().min(0))).required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">28</td>
                            <td class="hits"></td>
                            <td class="source">      unit: Joi.alternatives().try(Joi.string(), Joi.array().includes(Joi.string())).required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">29</td>
                            <td class="hits"></td>
                            <td class="source">      shipping: Joi.string(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">30</td>
                            <td class="hits"></td>
                            <td class="source">      notes: Joi.string()</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">31</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">32</td>
                            <td class="hits"></td>
                            <td class="source">  },</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">33</td>
                            <td class="hits"></td>
                            <td class="source">  handler: function (req, reply) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">34</td>
                            <td class="hits">1</td>
                            <td class="source">    log.info({METHOD: &quot;Recieved POST&quot;});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">35</td>
                            <td class="hits">1</td>
                            <td class="source">    console.dir(req.auth);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">36</td>
                            <td class="hits"></td>
                            <td class="source">    //NORMALIZING INPUT</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">37</td>
                            <td class="hits">1</td>
                            <td class="source">    var cleanedFarmer = myUtils.lowerAndTrim(req.payload.farmer);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">38</td>
                            <td class="hits">1</td>
                            <td class="source">    var cleanedProducts = myUtils.lowerAndTrim(req.payload.productName);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">39</td>
                            <td class="hits">1</td>
                            <td class="source">    var cleanedInitials = myUtils.lowerAndTrim(req.payload.farmerInitials);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">40</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">41</td>
                            <td class="hits"></td>
                            <td class="source">    //TURNING PRODUCTS INTO ARRAY FOR EASIER HANDLING</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">42</td>
                            <td class="hits">1</td>
                            <td class="source">    cleanedProducts = myUtils.arrayify(cleanedProducts);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">43</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">44</td>
                            <td class="hits"></td>
                            <td class="source">    //CALCULATING TOTAL</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">45</td>
                            <td class="hits">1</td>
                            <td class="source">    var total = 0;</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">46</td>
                                <td class="hits"></td>
                                <td class="source"><div>    if (</div><div class="miss false">cleanedProducts.length === 1</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">47</td>
                            <td class="hits"></td>
                            <td class="source">      //IF ONLY ONE ITEM THE PRICE OF THAT ITEM IS THE TOTAL</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">48</td>
                                <td class="hits"></td>
                                <td class="source">      total = req.payload.price;</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">49</td>
                            <td class="hits"></td>
                            <td class="source">    } else {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">50</td>
                            <td class="hits">1</td>
                            <td class="source">      total = cleanedProducts.reduce(function (prev, curr, index) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">51</td>
                            <td class="hits">2</td>
                            <td class="source">        return prev + (req.payload.price[index] * req.payload.quantity[index]);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">52</td>
                            <td class="hits"></td>
                            <td class="source">      }, total);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">53</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">54</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">55</td>
                                <td class="hits"></td>
                                <td class="source"><div>    if (</div><div class="miss true">!!req.payload.shipping</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">56</td>
                            <td class="hits">1</td>
                            <td class="source">      total += (total * 0.1).toFixed(2);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">57</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">58</td>
                            <td class="hits"></td>
                            <td class="source">    //CREATING NEW ORDER OBJECT</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">59</td>
                            <td class="hits">1</td>
                            <td class="source">    var newOrder = new Order({</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">60</td>
                            <td class="hits"></td>
                            <td class="source">      farmer: cleanedFarmer,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">61</td>
                            <td class="hits"></td>
                            <td class="source">      farmerInitials: cleanedInitials,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">62</td>
                            <td class="hits"></td>
                            <td class="source">      products: cleanedProducts,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">63</td>
                            <td class="hits"></td>
                            <td class="source">      quantities: req.payload.quantity,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">64</td>
                            <td class="hits"></td>
                            <td class="source">      prices: req.payload.price,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">65</td>
                            <td class="hits"></td>
                            <td class="source">      notes: req.payload.notes,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">66</td>
                            <td class="hits"></td>
                            <td class="source">      unit: req.payload.unit,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">67</td>
                            <td class="hits"></td>
                            <td class="source">      shipping: !!req.payload.shipping,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">68</td>
                            <td class="hits"></td>
                            <td class="source">      total: total</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">69</td>
                            <td class="hits"></td>
                            <td class="source">    });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">70</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">71</td>
                            <td class="hits"></td>
                            <td class="source">    //RETURNING AN ARRAY OF ITEM OBJECTS TO LATER SAVE</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">72</td>
                            <td class="hits">1</td>
                            <td class="source">    var inventoryItems = cleanedProducts.map(function (item, index) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">73</td>
                                <td class="hits"></td>
                                <td class="source"><div>      if (</div><div class="miss false">cleanedProducts.length === 1</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">74</td>
                                <td class="hits"></td>
                                <td class="source">        return new Item({</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">75</td>
                            <td class="hits"></td>
                            <td class="source">          product: item,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">76</td>
                            <td class="hits"></td>
                            <td class="source">          price: req.payload.price,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">77</td>
                            <td class="hits"></td>
                            <td class="source">          farmerInitials: cleanedInitials,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">78</td>
                            <td class="hits"></td>
                            <td class="source">          quantity: req.payload.quantity,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">79</td>
                            <td class="hits"></td>
                            <td class="source">          unit: req.payload.unit,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">80</td>
                            <td class="hits"></td>
                            <td class="source">          farmer: cleanedFarmer</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">81</td>
                            <td class="hits"></td>
                            <td class="source">        });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">82</td>
                            <td class="hits"></td>
                            <td class="source">      }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">83</td>
                            <td class="hits"></td>
                            <td class="source">      //IF MORE THAN ONE PRODUCT, MATCHES THE PRODUCT TO ITS RESPECTIVE QUANTITY</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">84</td>
                            <td class="hits"></td>
                            <td class="source">      //AND PRICE</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">85</td>
                            <td class="hits">2</td>
                            <td class="source">      return new Item({</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">86</td>
                            <td class="hits"></td>
                            <td class="source">        product: item,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">87</td>
                            <td class="hits"></td>
                            <td class="source">        farmerInitials: cleanedInitials,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">88</td>
                            <td class="hits"></td>
                            <td class="source">        price: req.payload.price[index],</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">89</td>
                            <td class="hits"></td>
                            <td class="source">        unit: req.payload.unit[index],</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">90</td>
                            <td class="hits"></td>
                            <td class="source">        quantity: req.payload.quantity[index],</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">91</td>
                            <td class="hits"></td>
                            <td class="source">        farmer: cleanedFarmer</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">92</td>
                            <td class="hits"></td>
                            <td class="source">      });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">93</td>
                            <td class="hits"></td>
                            <td class="source">    });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">94</td>
                            <td class="hits"></td>
                            <td class="source">    //SAVING THE NEW ITEM TO THE DATABASE</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">95</td>
                            <td class="hits">1</td>
                            <td class="source">    inventoryItems.forEach(function (item) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">96</td>
                            <td class="hits">2</td>
                            <td class="source">      item.save(function (err, i) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">97</td>
                                <td class="hits"></td>
                                <td class="source"><div>        if (</div><div class="miss false">err</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">98</td>
                                <td class="hits"></td>
                                <td class="source">          return log.error({err: err});</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">99</td>
                            <td class="hits"></td>
                            <td class="source">        }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">100</td>
                            <td class="hits">2</td>
                            <td class="source">        log.info({&quot;New Item:&quot;: i});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">101</td>
                            <td class="hits"></td>
                            <td class="source">      });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">102</td>
                            <td class="hits"></td>
                            <td class="source">    });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">103</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">104</td>
                            <td class="hits"></td>
                            <td class="source">    //SAVING THE NEW ORDER TO THE DATABASE</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">105</td>
                            <td class="hits">1</td>
                            <td class="source">    newOrder.save(function (err, order) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">106</td>
                                <td class="hits"></td>
                                <td class="source"><div>      if (</div><div class="miss false">err</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">107</td>
                                <td class="hits"></td>
                                <td class="source">        return log.error({error: err});</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">108</td>
                            <td class="hits"></td>
                            <td class="source">      }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">109</td>
                            <td class="hits">1</td>
                            <td class="source">      log.info({&quot;Order Saved&quot;: order});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">110</td>
                            <td class="hits">1</td>
                            <td class="source">      reply({&quot;logStatus&quot; : &quot;success&quot;});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">111</td>
                            <td class="hits"></td>
                            <td class="source">    });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">112</td>
                            <td class="hits"></td>
                            <td class="source">  }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">113</td>
                            <td class="hits"></td>
                            <td class="source">};</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">114</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">115</td>
                            <td class="hits"></td>
                            <td class="source">//TODO</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">116</td>
                            <td class="hits"></td>
                            <td class="source">//ROUTE FOR GETTING ORDERS FROM DB</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">117</td>
                            <td class="hits">1</td>
                            <td class="source">exports.getOrders = {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">118</td>
                            <td class="hits"></td>
                            <td class="source">  auth: &quot;session&quot;,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">119</td>
                            <td class="hits"></td>
                            <td class="source">  handler: function (req, reply) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">120</td>
                                <td class="hits"></td>
                                <td class="source">    log.info(&quot;RECIEVED GET&quot;);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">121</td>
                            <td class="hits"></td>
                            <td class="source">    //log.info({req: req});</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">122</td>
                                <td class="hits"></td>
                                <td class="source">    reply(&quot;CAN&#x27;T PROCESS YET, but thanks for trying&quot;);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">123</td>
                            <td class="hits"></td>
                            <td class="source">  }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">124</td>
                            <td class="hits"></td>
                            <td class="source">};</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">125</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    </tbody>
                </table>
            </div>
            
            <div class="file">
                <h2 id="controllers/saleRoutes.js">controllers/saleRoutes.js</h2>
                <div class="stats high">
                    <div class="percentage">87.36%</div>
                    <div class="sloc">174</div>
                    <div class="hits">152</div>
                    <div class="misses">22</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Line</th>
                            <th>Hits</th>
                            <th>Source</th>
                        </tr>
                    </thead>
                    <tbody>
                
                    
                        <tr class="hit">
                            <td class="line">1</td>
                            <td class="hits"></td>
                            <td class="source">//ROUTES</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">2</td>
                            <td class="hits"></td>
                            <td class="source">//SALES</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">3</td>
                            <td class="hits">1</td>
                            <td class="source">var bunyan = require(&quot;bunyan&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">4</td>
                            <td class="hits"></td>
                            <td class="source">  Config = require(&quot;../server.config&quot;);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">5</td>
                            <td class="hits">1</td>
                            <td class="source">var log = bunyan.createLogger({</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">6</td>
                            <td class="hits"></td>
                            <td class="source">    name: Config.logger.name,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">7</td>
                            <td class="hits"></td>
                            <td class="source">    serializers: bunyan.stdSerializers,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">8</td>
                            <td class="hits"></td>
                            <td class="source">    streams: Config.logger.streams</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">9</td>
                            <td class="hits"></td>
                            <td class="source">  });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">10</td>
                            <td class="hits">1</td>
                            <td class="source">var myUtils = require(&quot;../utils/myUtils&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">11</td>
                            <td class="hits"></td>
                            <td class="source">  Hapi = require(&quot;hapi&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">12</td>
                            <td class="hits"></td>
                            <td class="source">  Joi = require(&quot;joi&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">13</td>
                            <td class="hits"></td>
                            <td class="source">  Sale = require(&quot;../models/schema&quot;).Sale,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">14</td>
                            <td class="hits"></td>
                            <td class="source">  Item = require(&quot;../models/schema&quot;).Item;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">15</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">16</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">17</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">18</td>
                            <td class="hits"></td>
                            <td class="source">//ROUTE FOR GETTING A TOTAL FOR THE SALE</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">19</td>
                            <td class="hits">1</td>
                            <td class="source">exports.getTotal = {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">20</td>
                            <td class="hits"></td>
                            <td class="source">  validate: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">21</td>
                            <td class="hits"></td>
                            <td class="source">    query: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">22</td>
                            <td class="hits"></td>
                            <td class="source">      productName: Joi.alternatives().try(Joi.string(), Joi.array().includes(Joi.string())).required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">23</td>
                            <td class="hits"></td>
                            <td class="source">      quantity: Joi.alternatives().try(Joi.number().min(1), Joi.array().includes(Joi.number().min(1))).required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">24</td>
                            <td class="hits"></td>
                            <td class="source">      notes: Joi.string(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">25</td>
                            <td class="hits"></td>
                            <td class="source">      shipping: Joi.string(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">26</td>
                            <td class="hits"></td>
                            <td class="source">      delivery: Joi.number().required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">27</td>
                            <td class="hits"></td>
                            <td class="source">      farmerInitials: Joi.alternatives().try(Joi.string(), Joi.array().includes(Joi.string())).required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">28</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">29</td>
                            <td class="hits"></td>
                            <td class="source">  },</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">30</td>
                            <td class="hits"></td>
                            <td class="source">  handler: function (req, reply) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">31</td>
                            <td class="hits">2</td>
                            <td class="source">    log.info({METHOD: &quot;RECIEVED GET&quot;});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">32</td>
                            <td class="hits"></td>
                            <td class="source">    //log.info({req: req});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">33</td>
                            <td class="hits"></td>
                            <td class="source">    //NORMALIZING INPUT</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">34</td>
                            <td class="hits">2</td>
                            <td class="source">    var cleanedProducts = myUtils.lowerAndTrim(req.query.productName);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">35</td>
                            <td class="hits">2</td>
                            <td class="source">    var cleanedInitials = myUtils.lowerAndTrim(req.query.farmerInitials);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">36</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">37</td>
                            <td class="hits"></td>
                            <td class="source">    //CALCULATING TOTAL AND ORDER_ID</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">38</td>
                            <td class="hits">2</td>
                            <td class="source">    var total = 0,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">39</td>
                            <td class="hits"></td>
                            <td class="source">      orderNum = 0;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">40</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">41</td>
                            <td class="hits">2</td>
                            <td class="source">    cleanedProducts = myUtils.arrayify(cleanedProducts);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">42</td>
                            <td class="hits">2</td>
                            <td class="source">    cleanedInitials = myUtils.arrayify(cleanedInitials);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">43</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">44</td>
                            <td class="hits">2</td>
                            <td class="source">    Sale.count({}, function (err, count) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">45</td>
                                <td class="hits"></td>
                                <td class="source"><div>      if (</div><div class="miss false">err</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">46</td>
                                <td class="hits"></td>
                                <td class="source">        reply(err);</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">47</td>
                                <td class="hits"></td>
                                <td class="source">        log.error({err: err});</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">48</td>
                            <td class="hits"></td>
                            <td class="source">      }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">49</td>
                            <td class="hits">2</td>
                            <td class="source">      orderNum = count;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">50</td>
                            <td class="hits"></td>
                            <td class="source">    });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">51</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">52</td>
                            <td class="hits"></td>
                            <td class="source">    //FOR EACH PRODUCT FINDING ITS PRICE VIA THE MOST RECENT PRODUCT FROM THE FARMER</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">53</td>
                            <td class="hits"></td>
                            <td class="source">    //THEN ADDING TI TO THE TOTAL</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">54</td>
                            <td class="hits">2</td>
                            <td class="source">    cleanedProducts.forEach(function (product, index) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">55</td>
                            <td class="hits">4</td>
                            <td class="source">      Item.findOne({</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">56</td>
                            <td class="hits"></td>
                            <td class="source">        &quot;product&quot;: product,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">57</td>
                            <td class="hits"></td>
                            <td class="source">        &quot;farmerInitials&quot;: cleanedInitials[index]</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">58</td>
                            <td class="hits"></td>
                            <td class="source">      }).lean()</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">59</td>
                            <td class="hits"></td>
                            <td class="source">        .select(&quot;product price farmer inStock&quot;)</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">60</td>
                            <td class="hits"></td>
                            <td class="source">        .sort(&quot;-date&quot;)</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">61</td>
                            <td class="hits"></td>
                            <td class="source">        .limit(1)</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">62</td>
                            <td class="hits"></td>
                            <td class="source">        .exec(function (err, item) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">63</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">64</td>
                            <td class="hits">4</td>
                            <td class="source">          var thisQuantity;</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">65</td>
                                <td class="hits"></td>
                                <td class="source"><div>          if (</div><div class="miss false">err</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">66</td>
                                <td class="hits"></td>
                                <td class="source">            reply(err);</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">67</td>
                                <td class="hits"></td>
                                <td class="source">            return;</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">68</td>
                            <td class="hits"></td>
                            <td class="source">          }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">69</td>
                            <td class="hits"></td>
                            <td class="source">          //IF PRODUCT IS NOT FOUND</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">70</td>
                            <td class="hits">4</td>
                            <td class="source">          if (!item || item === null) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">71</td>
                            <td class="hits">2</td>
                            <td class="source">            var error = Hapi.error.notFound(&quot;Product: &quot; + product + &quot; from &quot; +  cleanedInitials[index] + &quot; not found&quot;);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">72</td>
                            <td class="hits">2</td>
                            <td class="source">            reply(error);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">73</td>
                            <td class="hits">2</td>
                            <td class="source">            return;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">74</td>
                            <td class="hits"></td>
                            <td class="source">          }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">75</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">76</td>
                                <td class="hits"></td>
                                <td class="source"><div>          if (</div><div class="miss false">item.inStock === false</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">77</td>
                                <td class="hits"></td>
                                <td class="source">            reply({logStatus: item.product + &quot; not in stock&quot;});</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">78</td>
                                <td class="hits"></td>
                                <td class="source">            return;</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">79</td>
                            <td class="hits"></td>
                            <td class="source">          }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">80</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">81</td>
                                <td class="hits"></td>
                                <td class="source"><div>          if (</div><div class="miss false">cleanedProducts.length === 1</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">82</td>
                                <td class="hits"></td>
                                <td class="source">            thisQuantity = req.query.quantity;</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">83</td>
                            <td class="hits"></td>
                            <td class="source">          } else {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">84</td>
                            <td class="hits">2</td>
                            <td class="source">            thisQuantity = req.query.quantity[index];</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">85</td>
                            <td class="hits"></td>
                            <td class="source">          }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">86</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">87</td>
                            <td class="hits"></td>
                            <td class="source">          //CALCULATING THE TOTAL</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">88</td>
                            <td class="hits">2</td>
                            <td class="source">          total += item.price * thisQuantity;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">89</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">90</td>
                            <td class="hits"></td>
                            <td class="source">          //IF IT&#x27;S THE LAST ITEM TO CALCULATE, SAVE THE THE STARTED SALE TO DB</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">91</td>
                            <td class="hits">2</td>
                            <td class="source">          if (index + 1 === cleanedProducts.length) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">92</td>
                                <td class="hits"></td>
                                <td class="source"><div>            if (</div><div class="miss true">!!req.query.shipping</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">93</td>
                                <td class="hits"></td>
                                <td class="source"><div>              total += (total * 0.1) + (</div><div class="miss true">req.query.delivery</div><div> || </div><div class="miss never">0</div><div>);</div></td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">94</td>
                            <td class="hits"></td>
                            <td class="source">            }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">95</td>
                            <td class="hits">1</td>
                            <td class="source">            total = parseFloat(total.toFixed(2));</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">96</td>
                            <td class="hits">1</td>
                            <td class="source">            var thisSale = new Sale({</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">97</td>
                            <td class="hits"></td>
                            <td class="source">              _id: orderNum,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">98</td>
                            <td class="hits"></td>
                            <td class="source">              total: total</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">99</td>
                            <td class="hits"></td>
                            <td class="source">            });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">100</td>
                            <td class="hits">1</td>
                            <td class="source">            thisSale.save(function (err) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">101</td>
                                <td class="hits"></td>
                                <td class="source"><div>              if (</div><div class="miss false">err</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">102</td>
                                <td class="hits"></td>
                                <td class="source">                log.error({err: err});</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">103</td>
                                <td class="hits"></td>
                                <td class="source">                reply(err);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">104</td>
                            <td class="hits"></td>
                            <td class="source">              }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">105</td>
                            <td class="hits"></td>
                            <td class="source">            });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">106</td>
                            <td class="hits">1</td>
                            <td class="source">            log.info({_id: orderNum, total: total});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">107</td>
                            <td class="hits"></td>
                            <td class="source">            //REPLYING WITH THE INFO FOR THE SUBMITTING THE ORDER</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">108</td>
                            <td class="hits">1</td>
                            <td class="source">            reply({_id: orderNum, total: total});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">109</td>
                            <td class="hits"></td>
                            <td class="source">          }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">110</td>
                            <td class="hits"></td>
                            <td class="source">        });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">111</td>
                            <td class="hits"></td>
                            <td class="source">    });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">112</td>
                            <td class="hits"></td>
                            <td class="source">  }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">113</td>
                            <td class="hits"></td>
                            <td class="source">};</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">114</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">115</td>
                            <td class="hits"></td>
                            <td class="source">//ROUTE FOR SUBMITTING FINALIZED SALES</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">116</td>
                            <td class="hits">1</td>
                            <td class="source">exports.postSale = {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">117</td>
                            <td class="hits"></td>
                            <td class="source">  validate: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">118</td>
                            <td class="hits"></td>
                            <td class="source">    payload: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">119</td>
                            <td class="hits"></td>
                            <td class="source">      _id: Joi.number().min(0).required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">120</td>
                            <td class="hits"></td>
                            <td class="source">      productName: Joi.alternatives().try(Joi.string(), Joi.array().includes(Joi.string())).required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">121</td>
                            <td class="hits"></td>
                            <td class="source">      quantity: Joi.alternatives().try(Joi.number().min(1), Joi.array().includes(Joi.number().min(1))).required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">122</td>
                            <td class="hits"></td>
                            <td class="source">      farmerInitials: Joi.alternatives().try(Joi.string(), Joi.array().includes(Joi.string())).required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">123</td>
                            <td class="hits"></td>
                            <td class="source">      shipping: Joi.string(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">124</td>
                            <td class="hits"></td>
                            <td class="source">      delivery: Joi.number().required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">125</td>
                            <td class="hits"></td>
                            <td class="source">      notes: Joi.string(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">126</td>
                            <td class="hits"></td>
                            <td class="source">      total: Joi.number().required()</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">127</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">128</td>
                            <td class="hits"></td>
                            <td class="source">  },</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">129</td>
                            <td class="hits"></td>
                            <td class="source">  handler: function (req, reply) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">130</td>
                            <td class="hits">1</td>
                            <td class="source">    log.info({METHOD: &quot;Recieved POST&quot;});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">131</td>
                            <td class="hits"></td>
                            <td class="source">    //log.info({req: req});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">132</td>
                            <td class="hits"></td>
                            <td class="source">    //NORMAILZING INPUT</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">133</td>
                            <td class="hits">1</td>
                            <td class="source">    var cleanedInitials = myUtils.lowerAndTrim(req.payload.farmerInitials);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">134</td>
                            <td class="hits">1</td>
                            <td class="source">    var cleanedProducts = myUtils.lowerAndTrim(req.payload.productName);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">135</td>
                            <td class="hits">1</td>
                            <td class="source">    var cleanedQuantities = req.payload.quantity;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">136</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">137</td>
                            <td class="hits">1</td>
                            <td class="source">    cleanedProducts = myUtils.arrayify(cleanedProducts);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">138</td>
                            <td class="hits">1</td>
                            <td class="source">    cleanedInitials = myUtils.arrayify(cleanedInitials);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">139</td>
                            <td class="hits">1</td>
                            <td class="source">    cleanedQuantities = myUtils.arrayify(cleanedQuantities);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">140</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">141</td>
                            <td class="hits"></td>
                            <td class="source">    //Decrementing item quantity</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">142</td>
                            <td class="hits">1</td>
                            <td class="source">    cleanedProducts.forEach(function (product, index) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">143</td>
                            <td class="hits">2</td>
                            <td class="source">      Item.findOne({</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">144</td>
                            <td class="hits"></td>
                            <td class="source">        &quot;product&quot;: product,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">145</td>
                            <td class="hits"></td>
                            <td class="source">        &quot;farmerInitials&quot;: cleanedInitials[index]</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">146</td>
                            <td class="hits"></td>
                            <td class="source">      }).lean()</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">147</td>
                            <td class="hits"></td>
                            <td class="source">        .select(&quot;product price farmer quantity inStock&quot;)</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">148</td>
                            <td class="hits"></td>
                            <td class="source">        .sort(&quot;-date&quot;)</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">149</td>
                            <td class="hits"></td>
                            <td class="source">        .limit(1)</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">150</td>
                            <td class="hits"></td>
                            <td class="source">        .exec(function (err, item) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">151</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">152</td>
                            <td class="hits">2</td>
                            <td class="source">          var thisQuantity;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">153</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">154</td>
                                <td class="hits"></td>
                                <td class="source"><div>          if (</div><div class="miss false">err</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">155</td>
                                <td class="hits"></td>
                                <td class="source">            reply(err);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">156</td>
                            <td class="hits"></td>
                            <td class="source">          } else {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">157</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">158</td>
                            <td class="hits">2</td>
                            <td class="source">            thisQuantity = -1 * cleanedQuantities[index];</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">159</td>
                            <td class="hits">2</td>
                            <td class="source">            log.info({&quot;Item before&quot;: item});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">160</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">161</td>
                            <td class="hits"></td>
                            <td class="source">            //decreasing quantity by 1</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">162</td>
                            <td class="hits">2</td>
                            <td class="source">            Item.findByIdAndUpdate(item._id,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">163</td>
                            <td class="hits"></td>
                            <td class="source">              {$inc : {quantity: thisQuantity}, $set: {inStock: (item.quantity + thisQuantity &gt; 0)}},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">164</td>
                            <td class="hits"></td>
                            <td class="source">              function (err, doc) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">165</td>
                                <td class="hits"></td>
                                <td class="source"><div>                if (</div><div class="miss false">err</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">166</td>
                                <td class="hits"></td>
                                <td class="source">                  log.error({err: err});</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">167</td>
                            <td class="hits"></td>
                            <td class="source">                }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">168</td>
                            <td class="hits">2</td>
                            <td class="source">                log.info({&quot;Item after&quot;: doc});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">169</td>
                            <td class="hits"></td>
                            <td class="source">              });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">170</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">171</td>
                            <td class="hits"></td>
                            <td class="source">            //UPDATING THE SALE WITH FINALIZED DATA</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">172</td>
                            <td class="hits">2</td>
                            <td class="source">            Sale.findByIdAndUpdate(</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">173</td>
                            <td class="hits"></td>
                            <td class="source">              req.payload._id,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">174</td>
                            <td class="hits"></td>
                            <td class="source">              {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">175</td>
                            <td class="hits"></td>
                            <td class="source">                farmerInitials: cleanedInitials,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">176</td>
                            <td class="hits"></td>
                            <td class="source">                products: cleanedProducts,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">177</td>
                            <td class="hits"></td>
                            <td class="source">                quantities: req.payload.quantity,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">178</td>
                            <td class="hits"></td>
                            <td class="source">                notes: req.payload.notes,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">179</td>
                            <td class="hits"></td>
                            <td class="source">                shipping: !!req.payload.shipping,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">180</td>
                            <td class="hits"></td>
                            <td class="source">                delivery: req.payload.delivery</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">181</td>
                            <td class="hits"></td>
                            <td class="source">              },</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">182</td>
                            <td class="hits"></td>
                            <td class="source">              function (err, doc) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">183</td>
                                <td class="hits"></td>
                                <td class="source"><div>                if (</div><div class="miss false">err</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">184</td>
                                <td class="hits"></td>
                                <td class="source">                  reply(err);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">185</td>
                            <td class="hits"></td>
                            <td class="source">                }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">186</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">187</td>
                            <td class="hits">2</td>
                            <td class="source">                log.info({&quot;CONFIRMED SALE&quot;: doc});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">188</td>
                            <td class="hits">2</td>
                            <td class="source">                reply({&quot;logStatus&quot; : &quot;success&quot;});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">189</td>
                            <td class="hits"></td>
                            <td class="source">              }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">190</td>
                            <td class="hits"></td>
                            <td class="source">            );</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">191</td>
                            <td class="hits"></td>
                            <td class="source">          }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">192</td>
                            <td class="hits"></td>
                            <td class="source">        });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">193</td>
                            <td class="hits"></td>
                            <td class="source">    });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">194</td>
                            <td class="hits"></td>
                            <td class="source">  }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">195</td>
                            <td class="hits"></td>
                            <td class="source">};</td>
                        </tr>
                    
                
                    </tbody>
                </table>
            </div>
            
            <div class="file">
                <h2 id="controllers/userRoutes.js">controllers/userRoutes.js</h2>
                <div class="stats high">
                    <div class="percentage">89.25%</div>
                    <div class="sloc">93</div>
                    <div class="hits">83</div>
                    <div class="misses">10</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Line</th>
                            <th>Hits</th>
                            <th>Source</th>
                        </tr>
                    </thead>
                    <tbody>
                
                    
                        <tr class="hit">
                            <td class="line">1</td>
                            <td class="hits"></td>
                            <td class="source">//ROUTES</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">2</td>
                            <td class="hits"></td>
                            <td class="source">//AUTHENTICATION</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">3</td>
                            <td class="hits">1</td>
                            <td class="source">var bunyan = require(&quot;bunyan&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">4</td>
                            <td class="hits"></td>
                            <td class="source">  Config = require(&quot;../server.config&quot;);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">5</td>
                            <td class="hits">1</td>
                            <td class="source">var log = bunyan.createLogger({</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">6</td>
                            <td class="hits"></td>
                            <td class="source">    name: Config.logger.name,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">7</td>
                            <td class="hits"></td>
                            <td class="source">    serializers: bunyan.stdSerializers,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">8</td>
                            <td class="hits"></td>
                            <td class="source">    streams: Config.logger.streams</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">9</td>
                            <td class="hits"></td>
                            <td class="source">  });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">10</td>
                            <td class="hits">1</td>
                            <td class="source">var Joi = require(&quot;joi&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">11</td>
                            <td class="hits"></td>
                            <td class="source">  Hapi = require(&quot;hapi&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">12</td>
                            <td class="hits"></td>
                            <td class="source">  User = require(&quot;../logic/user-logic&quot;).User,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">13</td>
                            <td class="hits"></td>
                            <td class="source">  path = require(&quot;path&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">14</td>
                            <td class="hits"></td>
                            <td class="source">  myUtils = require(&quot;../utils/myUtils&quot;);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">15</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">16</td>
                            <td class="hits">1</td>
                            <td class="source">exports.register = {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">17</td>
                            <td class="hits"></td>
                            <td class="source">    validate: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">18</td>
                            <td class="hits"></td>
                            <td class="source">        payload: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">19</td>
                            <td class="hits"></td>
                            <td class="source">            username: Joi.string().required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">20</td>
                            <td class="hits"></td>
                            <td class="source">            password: Joi.string().required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">21</td>
                            <td class="hits"></td>
                            <td class="source">            scope: Joi.number().required(),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">22</td>
                            <td class="hits"></td>
                            <td class="source">            name: Joi.string().required()</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">23</td>
                            <td class="hits"></td>
                            <td class="source">        }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">24</td>
                            <td class="hits"></td>
                            <td class="source">    },</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">25</td>
                            <td class="hits"></td>
                            <td class="source">    handler: function (req, reply) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">26</td>
                            <td class="hits">2</td>
                            <td class="source">        var id = myUtils.lowerAndTrim(req.payload.username);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">27</td>
                            <td class="hits">2</td>
                            <td class="source">        User.findById(id).lean().exec(function (err, user) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">28</td>
                                <td class="hits"></td>
                                <td class="source"><div>            if (</div><div class="miss false">err</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">29</td>
                                <td class="hits"></td>
                                <td class="source">                return reply(err);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">30</td>
                            <td class="hits"></td>
                            <td class="source">            }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">31</td>
                            <td class="hits">2</td>
                            <td class="source">            if (!user || user === null) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">32</td>
                            <td class="hits">1</td>
                            <td class="source">                var newUser = new User({</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">33</td>
                            <td class="hits"></td>
                            <td class="source">                    _id: id,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">34</td>
                            <td class="hits"></td>
                            <td class="source">                    scope: req.payload.scope,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">35</td>
                            <td class="hits"></td>
                            <td class="source">                    password: req.payload.password,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">36</td>
                            <td class="hits"></td>
                            <td class="source">                    name: req.payload.name</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">37</td>
                            <td class="hits"></td>
                            <td class="source">                });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">38</td>
                            <td class="hits">1</td>
                            <td class="source">                newUser.save(function (err, doc) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">39</td>
                                <td class="hits"></td>
                                <td class="source"><div>                    if (</div><div class="miss false">err</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">40</td>
                                <td class="hits"></td>
                                <td class="source">                        return reply(err);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">41</td>
                            <td class="hits"></td>
                            <td class="source">                    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">42</td>
                            <td class="hits"></td>
                            <td class="source">                    else {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">43</td>
                            <td class="hits">1</td>
                            <td class="source">                        console.log(&quot;new user:&quot;, doc);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">44</td>
                            <td class="hits">1</td>
                            <td class="source">                        return reply(doc);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">45</td>
                            <td class="hits"></td>
                            <td class="source">                    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">46</td>
                            <td class="hits"></td>
                            <td class="source">                });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">47</td>
                            <td class="hits"></td>
                            <td class="source">            } else {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">48</td>
                            <td class="hits">1</td>
                            <td class="source">                var error = Hapi.error.conflict(&quot;User: &quot; + user._id + &quot; already exists&quot;);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">49</td>
                            <td class="hits">1</td>
                            <td class="source">                return reply(error);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">50</td>
                            <td class="hits"></td>
                            <td class="source">            }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">51</td>
                            <td class="hits"></td>
                            <td class="source">        });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">52</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">53</td>
                            <td class="hits"></td>
                            <td class="source">}</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">54</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">55</td>
                            <td class="hits">1</td>
                            <td class="source">exports.delete = {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">56</td>
                            <td class="hits"></td>
                            <td class="source">    validate: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">57</td>
                            <td class="hits"></td>
                            <td class="source">        params: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">58</td>
                            <td class="hits"></td>
                            <td class="source">            username: Joi.string().required()</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">59</td>
                            <td class="hits"></td>
                            <td class="source">        }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">60</td>
                            <td class="hits"></td>
                            <td class="source">    },</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">61</td>
                            <td class="hits"></td>
                            <td class="source">    handler: function (req, reply) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">62</td>
                            <td class="hits">1</td>
                            <td class="source">        var id = myUtils.lowerAndTrim(req.params.username);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">63</td>
                            <td class="hits">1</td>
                            <td class="source">        User.findByIdAndRemove(id).exec(function (err, user) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">64</td>
                                <td class="hits"></td>
                                <td class="source"><div>            if (</div><div class="miss false">err</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">65</td>
                                <td class="hits"></td>
                                <td class="source">                return reply(err);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">66</td>
                            <td class="hits"></td>
                            <td class="source">            } else {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">67</td>
                            <td class="hits">1</td>
                            <td class="source">                console.log(&quot;Deleted&quot;, user);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">68</td>
                            <td class="hits">1</td>
                            <td class="source">                return reply(user);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">69</td>
                            <td class="hits"></td>
                            <td class="source">            }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">70</td>
                            <td class="hits"></td>
                            <td class="source">        });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">71</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">72</td>
                            <td class="hits"></td>
                            <td class="source">}</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">73</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">74</td>
                            <td class="hits">1</td>
                            <td class="source">exports.get = {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">75</td>
                            <td class="hits"></td>
                            <td class="source">    validate: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">76</td>
                            <td class="hits"></td>
                            <td class="source">        params: {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">77</td>
                            <td class="hits"></td>
                            <td class="source">            username: Joi.string()</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">78</td>
                            <td class="hits"></td>
                            <td class="source">        }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">79</td>
                            <td class="hits"></td>
                            <td class="source">    },</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">80</td>
                            <td class="hits"></td>
                            <td class="source">    handler: function (req, reply) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">81</td>
                            <td class="hits">2</td>
                            <td class="source">        var id = req.params.username,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">82</td>
                            <td class="hits"></td>
                            <td class="source">            query = (req.params.username ? {_id: myUtils.lowerAndTrim(id)} : {});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">83</td>
                            <td class="hits">2</td>
                            <td class="source">        console.log(&quot;Query&quot;, query);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">84</td>
                            <td class="hits">2</td>
                            <td class="source">        User.find(query).exec(function (err, users) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">85</td>
                                <td class="hits"></td>
                                <td class="source"><div>            if (</div><div class="miss false">err</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">86</td>
                                <td class="hits"></td>
                                <td class="source">                return reply(err);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">87</td>
                            <td class="hits"></td>
                            <td class="source">            }</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">88</td>
                                <td class="hits"></td>
                                <td class="source"><div>            if (</div><div class="miss false">!users</div><div> || users == false) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">89</td>
                                <td class="hits"></td>
                                <td class="source">                return reply(Hapi.error.notFound(&quot;User not found&quot;));</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">90</td>
                            <td class="hits"></td>
                            <td class="source">            } else {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">91</td>
                            <td class="hits">2</td>
                            <td class="source">                console.log(&quot;Requested User-list&quot;);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">92</td>
                            <td class="hits">2</td>
                            <td class="source">                return reply(users);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">93</td>
                            <td class="hits"></td>
                            <td class="source">            }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">94</td>
                            <td class="hits"></td>
                            <td class="source">        });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">95</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">96</td>
                            <td class="hits"></td>
                            <td class="source">}</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">97</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    </tbody>
                </table>
            </div>
            
            <div class="file">
                <h2 id="logic/user-logic.js">logic/user-logic.js</h2>
                <div class="stats medium">
                    <div class="percentage">64.46%</div>
                    <div class="sloc">121</div>
                    <div class="hits">78</div>
                    <div class="misses">43</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Line</th>
                            <th>Hits</th>
                            <th>Source</th>
                        </tr>
                    </thead>
                    <tbody>
                
                    
                        <tr class="hit">
                            <td class="line">1</td>
                            <td class="hits">1</td>
                            <td class="source">var mongoose = require(&quot;../database&quot;).mongoose,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">2</td>
                            <td class="hits"></td>
                            <td class="source">  Schema = mongoose.Schema,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">3</td>
                            <td class="hits"></td>
                            <td class="source">  bcrypt = require(&quot;bcrypt&quot;),</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">4</td>
                            <td class="hits"></td>
                            <td class="source">  SALT_WORK_FACTOR = 10,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">5</td>
                            <td class="hits"></td>
                            <td class="source">  MAX_LOGIN_ATTEMPTS = 5,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">6</td>
                            <td class="hits"></td>
                            <td class="source">  LOCK_TIME = 2 * 60 * 60 * 1000;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">7</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">8</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">9</td>
                            <td class="hits">1</td>
                            <td class="source">var userSchema = new Schema({</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">10</td>
                            <td class="hits"></td>
                            <td class="source">  _id: {type: String, required: true},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">11</td>
                            <td class="hits"></td>
                            <td class="source">  scope: {type: Number, required: true},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">12</td>
                            <td class="hits"></td>
                            <td class="source">  name: {type: String, required: true},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">13</td>
                            <td class="hits"></td>
                            <td class="source">  password: {type: String, required: true},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">14</td>
                            <td class="hits"></td>
                            <td class="source">  loginAttempts: {type: Number, required: true, default: 0},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">15</td>
                            <td class="hits"></td>
                            <td class="source">  lockUntil: {type: Number}</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">16</td>
                            <td class="hits"></td>
                            <td class="source">}, {collection: &quot;internalUsers&quot;});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">17</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">18</td>
                            <td class="hits">1</td>
                            <td class="source">userSchema.virtual(&#x27;isLocked&#x27;).get(function () {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">19</td>
                            <td class="hits"></td>
                            <td class="source">  //CHECK lockUntil TIMESTAMP</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">20</td>
                                <td class="hits"></td>
                                <td class="source">  return !!(this.lockUntil &amp;&amp; this.lockUntil &gt; Date.now());</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">21</td>
                            <td class="hits"></td>
                            <td class="source">});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">22</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">23</td>
                            <td class="hits">1</td>
                            <td class="source">userSchema.pre(&quot;save&quot;, function (next) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">24</td>
                            <td class="hits">1</td>
                            <td class="source">  var user = this;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">25</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">26</td>
                            <td class="hits"></td>
                            <td class="source">  //ONLY HASH IF MODIFIED/CREATED</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">27</td>
                                <td class="hits"></td>
                                <td class="source"><div>  if (</div><div class="miss false">!user.isModified(&quot;password&quot;)</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">28</td>
                                <td class="hits"></td>
                                <td class="source">    return next();</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">29</td>
                            <td class="hits"></td>
                            <td class="source">  }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">30</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">31</td>
                            <td class="hits"></td>
                            <td class="source">  //GENERATE SALT</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">32</td>
                            <td class="hits">1</td>
                            <td class="source">  bcrypt.genSalt(SALT_WORK_FACTOR, function (err, salt) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">33</td>
                                <td class="hits"></td>
                                <td class="source"><div>    if (</div><div class="miss false">err</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">34</td>
                                <td class="hits"></td>
                                <td class="source">      return next(err);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">35</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">36</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">37</td>
                            <td class="hits"></td>
                            <td class="source">    //HASH CONCATENATED PASSWORD AND SALT</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">38</td>
                            <td class="hits">1</td>
                            <td class="source">    bcrypt.hash(user.password, salt, function (err, hash) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">39</td>
                                <td class="hits"></td>
                                <td class="source"><div>      if (</div><div class="miss false">err</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">40</td>
                                <td class="hits"></td>
                                <td class="source">        return next(err);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">41</td>
                            <td class="hits"></td>
                            <td class="source">      }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">42</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">43</td>
                            <td class="hits">1</td>
                            <td class="source">      user.password = hash;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">44</td>
                            <td class="hits">1</td>
                            <td class="source">      next();</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">45</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">46</td>
                            <td class="hits"></td>
                            <td class="source">    });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">47</td>
                            <td class="hits"></td>
                            <td class="source">  });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">48</td>
                            <td class="hits"></td>
                            <td class="source">});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">49</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">50</td>
                            <td class="hits">1</td>
                            <td class="source">userSchema.methods.comparePassword = function (candidate, cb) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">51</td>
                                <td class="hits"></td>
                                <td class="source">  bcrypt.compare(candidate, this.password, function (err, isMatch) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">52</td>
                                <td class="hits"></td>
                                <td class="source">    if (err) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">53</td>
                                <td class="hits"></td>
                                <td class="source">      return cb(err);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">54</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">55</td>
                                <td class="hits"></td>
                                <td class="source">    cb(null, isMatch);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">56</td>
                            <td class="hits"></td>
                            <td class="source">  });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">57</td>
                            <td class="hits"></td>
                            <td class="source">};</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">58</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">59</td>
                            <td class="hits">1</td>
                            <td class="source">userSchema.methods.incLoginAttempts = function (cb) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">60</td>
                            <td class="hits"></td>
                            <td class="source">  // if we have a previosu lcok that has expired, restart at 1</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">61</td>
                                <td class="hits"></td>
                                <td class="source">  if (this.lockUntil &amp;&amp; this.lockUnil &lt; Date.now()) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">62</td>
                                <td class="hits"></td>
                                <td class="source">    return this.update({</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">63</td>
                            <td class="hits"></td>
                            <td class="source">      $set: {loginAttempts: 1},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">64</td>
                            <td class="hits"></td>
                            <td class="source">      $unset: {lockUntil: 1}</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">65</td>
                            <td class="hits"></td>
                            <td class="source">    }, cb);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">66</td>
                            <td class="hits"></td>
                            <td class="source">  }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">67</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">68</td>
                            <td class="hits"></td>
                            <td class="source">  //otherwise increment</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">69</td>
                                <td class="hits"></td>
                                <td class="source">  var updates = {$inc: {loginAttempts: 1}};</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">70</td>
                            <td class="hits"></td>
                            <td class="source">  //lock if MAX_ATTEMPTS reached</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">71</td>
                                <td class="hits"></td>
                                <td class="source">  if (this.loginAttempts + 1 &gt;= MAX_LOGIN_ATTEMPTS &amp;&amp; !this.isLocked) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">72</td>
                                <td class="hits"></td>
                                <td class="source">    updates.$set = {lockUntil: Date.now() + LOCK_TIME};</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">73</td>
                            <td class="hits"></td>
                            <td class="source">  }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">74</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">75</td>
                                <td class="hits"></td>
                                <td class="source">  return this.update(updates, cb);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">76</td>
                            <td class="hits"></td>
                            <td class="source">};</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">77</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">78</td>
                            <td class="hits">1</td>
                            <td class="source">var reasons = userSchema.statics.failedLogin = {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">79</td>
                            <td class="hits"></td>
                            <td class="source">  NOT_FOUND: 0,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">80</td>
                            <td class="hits"></td>
                            <td class="source">  PASSWORD_INCORRECT: 1,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">81</td>
                            <td class="hits"></td>
                            <td class="source">  MAX_ATTEMPTS: 2</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">82</td>
                            <td class="hits"></td>
                            <td class="source">};</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">83</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">84</td>
                            <td class="hits">1</td>
                            <td class="source">var scopes = userSchema.statics.scopes = {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">85</td>
                            <td class="hits"></td>
                            <td class="source">  admin: 0,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">86</td>
                            <td class="hits"></td>
                            <td class="source">  manager: 1,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">87</td>
                            <td class="hits"></td>
                            <td class="source">  employeeSales: 2,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">88</td>
                            <td class="hits"></td>
                            <td class="source">  employeeOrders: 3,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">89</td>
                            <td class="hits"></td>
                            <td class="source">  user: 5</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">90</td>
                            <td class="hits"></td>
                            <td class="source">};</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">91</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">92</td>
                            <td class="hits">1</td>
                            <td class="source">userSchema.statics.getAuthenticated = function (username, password, cb) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">93</td>
                                <td class="hits"></td>
                                <td class="source">  this.findOne({_id: username}, function (err, user) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">94</td>
                                <td class="hits"></td>
                                <td class="source">    if (err) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">95</td>
                                <td class="hits"></td>
                                <td class="source">      return cb(err);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">96</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">97</td>
                                <td class="hits"></td>
                                <td class="source">    console.log(&quot;USER&quot;, user);</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">98</td>
                                <td class="hits"></td>
                                <td class="source">    if (!user || user === null) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">99</td>
                                <td class="hits"></td>
                                <td class="source">      return cb(null, null, reasons.NOT_FOUND);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">100</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">101</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">102</td>
                                <td class="hits"></td>
                                <td class="source">    if (user.isLocked) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">103</td>
                                <td class="hits"></td>
                                <td class="source">      return user.incLoginAttempts(function (err) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">104</td>
                                <td class="hits"></td>
                                <td class="source">        if (err) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">105</td>
                                <td class="hits"></td>
                                <td class="source">          return cb(err);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">106</td>
                            <td class="hits"></td>
                            <td class="source">        }</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">107</td>
                                <td class="hits"></td>
                                <td class="source">        return cb(null, null, reasons.MAX_ATTEMPTS);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">108</td>
                            <td class="hits"></td>
                            <td class="source">      });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">109</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">110</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">111</td>
                                <td class="hits"></td>
                                <td class="source">    user.comparePassword(password, function (err, isMatch) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">112</td>
                                <td class="hits"></td>
                                <td class="source">      if (err) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">113</td>
                                <td class="hits"></td>
                                <td class="source">        return cb(err);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">114</td>
                            <td class="hits"></td>
                            <td class="source">      }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">115</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">116</td>
                                <td class="hits"></td>
                                <td class="source">      if (isMatch) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">117</td>
                                <td class="hits"></td>
                                <td class="source">        if (!user.loginAttempts &amp;&amp; !user.lockUntil) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">118</td>
                                <td class="hits"></td>
                                <td class="source">          return cb(null, user);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">119</td>
                            <td class="hits"></td>
                            <td class="source">        }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">120</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">121</td>
                                <td class="hits"></td>
                                <td class="source">        var updates = {</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">122</td>
                            <td class="hits"></td>
                            <td class="source">          $set: {loginAttempts: 0},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">123</td>
                            <td class="hits"></td>
                            <td class="source">          $unset: {lockUntil: 1}</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">124</td>
                            <td class="hits"></td>
                            <td class="source">        };</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">125</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">126</td>
                                <td class="hits"></td>
                                <td class="source">        return user.update(updates, function (err) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">127</td>
                                <td class="hits"></td>
                                <td class="source">          if (err) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">128</td>
                                <td class="hits"></td>
                                <td class="source">            return cb(err);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">129</td>
                            <td class="hits"></td>
                            <td class="source">          }</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">130</td>
                                <td class="hits"></td>
                                <td class="source">          return cb(null, user);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">131</td>
                            <td class="hits"></td>
                            <td class="source">        });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">132</td>
                            <td class="hits"></td>
                            <td class="source">      }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">133</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">134</td>
                                <td class="hits"></td>
                                <td class="source">      user.incLoginAttempts(function (err) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">135</td>
                                <td class="hits"></td>
                                <td class="source">        if (err) {</td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">136</td>
                                <td class="hits"></td>
                                <td class="source">          return cb(err);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">137</td>
                            <td class="hits"></td>
                            <td class="source">        }</td>
                        </tr>
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">138</td>
                                <td class="hits"></td>
                                <td class="source">        return cb(null, null, reasons.PASSWORD_INCORRECT);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">139</td>
                            <td class="hits"></td>
                            <td class="source">      });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">140</td>
                            <td class="hits"></td>
                            <td class="source">    });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">141</td>
                            <td class="hits"></td>
                            <td class="source">  });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">142</td>
                            <td class="hits"></td>
                            <td class="source">};</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">143</td>
                            <td class="hits">1</td>
                            <td class="source">exports.User = mongoose.model(&#x27;User&#x27;, userSchema);</td>
                        </tr>
                    
                
                    </tbody>
                </table>
            </div>
            
            <div class="file">
                <h2 id="models/schema.js">models/schema.js</h2>
                <div class="stats high">
                    <div class="percentage">100%</div>
                    <div class="sloc">37</div>
                    <div class="hits">37</div>
                    <div class="misses">0</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Line</th>
                            <th>Hits</th>
                            <th>Source</th>
                        </tr>
                    </thead>
                    <tbody>
                
                    
                        <tr class="hit">
                            <td class="line">1</td>
                            <td class="hits">1</td>
                            <td class="source">var mongoose = require(&quot;../database&quot;).mongoose,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">2</td>
                            <td class="hits"></td>
                            <td class="source">  Schema = mongoose.Schema;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">3</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">4</td>
                            <td class="hits"></td>
                            <td class="source">//SCHEMA</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">5</td>
                            <td class="hits">1</td>
                            <td class="source">var orderSchema = new Schema({</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">6</td>
                            <td class="hits"></td>
                            <td class="source">  farmer: String,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">7</td>
                            <td class="hits"></td>
                            <td class="source">  farmerInitials: String,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">8</td>
                            <td class="hits"></td>
                            <td class="source">  date: {type: Date, default: Date.now},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">9</td>
                            <td class="hits"></td>
                            <td class="source">  products: Array,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">10</td>
                            <td class="hits"></td>
                            <td class="source">  quantities: Array,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">11</td>
                            <td class="hits"></td>
                            <td class="source">  shipping: Boolean,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">12</td>
                            <td class="hits"></td>
                            <td class="source">  prices: Array,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">13</td>
                            <td class="hits"></td>
                            <td class="source">  notes: String,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">14</td>
                            <td class="hits"></td>
                            <td class="source">  total: Number</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">15</td>
                            <td class="hits"></td>
                            <td class="source">});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">16</td>
                            <td class="hits">1</td>
                            <td class="source">exports.Order = mongoose.model(&#x27;Order&#x27;, orderSchema);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">17</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">18</td>
                            <td class="hits">1</td>
                            <td class="source">var saleSchema = new Schema({</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">19</td>
                            <td class="hits"></td>
                            <td class="source">  _id: Number,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">20</td>
                            <td class="hits"></td>
                            <td class="source">  farmerInitials: Array,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">21</td>
                            <td class="hits"></td>
                            <td class="source">  date: {type: Date, default: Date.now},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">22</td>
                            <td class="hits"></td>
                            <td class="source">  products: Array,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">23</td>
                            <td class="hits"></td>
                            <td class="source">  quantities: Array,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">24</td>
                            <td class="hits"></td>
                            <td class="source">  shipping: Boolean,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">25</td>
                            <td class="hits"></td>
                            <td class="source">  delivery: Number,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">26</td>
                            <td class="hits"></td>
                            <td class="source">  notes: String,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">27</td>
                            <td class="hits"></td>
                            <td class="source">  total: Number</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">28</td>
                            <td class="hits"></td>
                            <td class="source">});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">29</td>
                            <td class="hits">1</td>
                            <td class="source">exports.Sale = mongoose.model(&#x27;Sale&#x27;, saleSchema);</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">30</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">31</td>
                            <td class="hits">1</td>
                            <td class="source">var itemSchema = new Schema({</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">32</td>
                            <td class="hits"></td>
                            <td class="source">  product: String,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">33</td>
                            <td class="hits"></td>
                            <td class="source">  price: Number,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">34</td>
                            <td class="hits"></td>
                            <td class="source">  farmer: String,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">35</td>
                            <td class="hits"></td>
                            <td class="source">  farmerInitials: String,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">36</td>
                            <td class="hits"></td>
                            <td class="source">  quantity: Number,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">37</td>
                            <td class="hits"></td>
                            <td class="source">  date: {type: Date, default: Date.now},</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">38</td>
                            <td class="hits"></td>
                            <td class="source">  inStock: {type: Boolean, default: true}</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">39</td>
                            <td class="hits"></td>
                            <td class="source">});</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">40</td>
                            <td class="hits">1</td>
                            <td class="source">exports.Item = mongoose.model(&#x27;Item&#x27;, itemSchema);</td>
                        </tr>
                    
                
                    </tbody>
                </table>
            </div>
            
            <div class="file">
                <h2 id="utils/myUtils.js">utils/myUtils.js</h2>
                <div class="stats high">
                    <div class="percentage">94.29%</div>
                    <div class="sloc">35</div>
                    <div class="hits">33</div>
                    <div class="misses">2</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Line</th>
                            <th>Hits</th>
                            <th>Source</th>
                        </tr>
                    </thead>
                    <tbody>
                
                    
                        <tr class="hit">
                            <td class="line">1</td>
                            <td class="hits"></td>
                            <td class="source">//FUNCTIONS</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">2</td>
                            <td class="hits"></td>
                            <td class="source">/*LOWER AND TRIM:</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">3</td>
                            <td class="hits"></td>
                            <td class="source"> * INPUT: a string or an array of strings</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">4</td>
                            <td class="hits"></td>
                            <td class="source"> * PROCESS: lower/trims every element in array</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">5</td>
                            <td class="hits"></td>
                            <td class="source"> * OUTPUT: an array of trimmed/lowered strings</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">6</td>
                            <td class="hits"></td>
                            <td class="source"> */</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">7</td>
                            <td class="hits">1</td>
                            <td class="source">exports.lowerAndTrim = function (arr) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">8</td>
                            <td class="hits">13</td>
                            <td class="source">  if (typeof arr === &quot;object&quot;) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">9</td>
                            <td class="hits">7</td>
                            <td class="source">    return arr.map(function (el) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">10</td>
                            <td class="hits">14</td>
                            <td class="source">      return el.trim().toLowerCase();</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">11</td>
                            <td class="hits"></td>
                            <td class="source">    });</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">12</td>
                            <td class="hits"></td>
                            <td class="source">  }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">13</td>
                            <td class="hits"></td>
                            <td class="source">  //IF IT IS JUST A STRING</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">14</td>
                            <td class="hits">6</td>
                            <td class="source">  return arr.trim().toLowerCase();</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">15</td>
                            <td class="hits"></td>
                            <td class="source">};</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">16</td>
                            <td class="hits">1</td>
                            <td class="source">exports.serializeJSON = function (obj) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">17</td>
                            <td class="hits">2</td>
                            <td class="source">  var attr, i,</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">18</td>
                            <td class="hits"></td>
                            <td class="source">    result = &quot;&quot;;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">19</td>
                            <td class="hits">2</td>
                            <td class="source">  for (attr in obj) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">20</td>
                            <td class="hits">10</td>
                            <td class="source">    if (obj[attr] instanceof Array) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">21</td>
                            <td class="hits">6</td>
                            <td class="source">      for (i in obj[attr]) {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">22</td>
                            <td class="hits">12</td>
                            <td class="source">        result += attr + &quot;=&quot; + obj[attr][i] + &quot;&amp;&quot;;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">23</td>
                            <td class="hits"></td>
                            <td class="source">      }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">24</td>
                            <td class="hits"></td>
                            <td class="source">    } else {</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">25</td>
                            <td class="hits">4</td>
                            <td class="source">      result += attr + &quot;=&quot; + obj[attr] + &#x27;&amp;&#x27;;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">26</td>
                            <td class="hits"></td>
                            <td class="source">    }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">27</td>
                            <td class="hits"></td>
                            <td class="source">  }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">28</td>
                            <td class="hits">2</td>
                            <td class="source">  return result;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">29</td>
                            <td class="hits"></td>
                            <td class="source">};</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">30</td>
                            <td class="hits"></td>
                            <td class="source"></td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">31</td>
                            <td class="hits">1</td>
                            <td class="source">exports.arrayify = function (str) {</td>
                        </tr>
                    
                
                    
                        
                            <tr class="chunks">
                                <td class="line">32</td>
                                <td class="hits"></td>
                                <td class="source"><div>  if (</div><div class="miss false">!(str instanceof Array)</div><div>) {</div></td>
                            </tr>
                        
                    
                
                    
                        
                            <tr class="miss">
                                <td class="line">33</td>
                                <td class="hits"></td>
                                <td class="source">    return [].concat(str);</td>
                            </tr>
                        
                    
                
                    
                        <tr class="hit">
                            <td class="line">34</td>
                            <td class="hits"></td>
                            <td class="source">  }</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">35</td>
                            <td class="hits">8</td>
                            <td class="source">  return str;</td>
                        </tr>
                    
                
                    
                        <tr class="hit">
                            <td class="line">36</td>
                            <td class="hits"></td>
                            <td class="source">};</td>
                        </tr>
                    
                
                    </tbody>
                </table>
            </div>
            
        </div>
    </div>
  </body>
</html>